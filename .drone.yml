---

kind: pipeline
type: ssh
name: deployment

server:
  host: 192.168.1.2
  user: vylpes
  password:
    from_secret: ssh_password

steps:
- name: deploy
  commands:
  - sh /home/vylpes/scripts/vylbot/deploy_prod.sh

trigger:
  branch:
  - main
  event:
  - promote
  target:
  - production

---

kind: pipeline
type: ssh
name: staging

server:
  host: 192.168.1.2
  user: vylpes
  password:
    from_secret: ssh_password

steps:
- name: deploy
  commands:
  - sh /home/vylpes/scripts/vylbot/deploy_stage.sh

trigger:
  branch:
  - develop
  event:
  - push

---

kind: pipeline
name: integration

steps:
- name: build
  image: node
  commands:
  - yarn install --frozen-lockfile
  - yarn build

- name: test
  image: node
  commands:
  - yarn install --frozen-lockfile
  - yarn test

trigger:
  branch:
  - main
  - develop
  - hotfix/*
  - feature/*
  - renovate/*
  event:
  - push
  - pull_request